SPA.ClientSide=function(x){function J(){var b;if(t.XMLHttpRequest)b=new XMLHttpRequest;else if(t.ActiveXObject)try{b=new ActiveXObject("Msxml2.XMLHTTP")}catch(h){b=new ActiveXObject("Microsoft.XMLHTTP")}return b}function K(b,h){if("string"===typeof h){var f=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})\.(\d{3})Z$/.exec(h);if(f)return new Date(Date.UTC(+f[1],+f[2]-1,+f[3],+f[4],+f[5],+f[6],+f[7]))}return h}var t=window,r={},u=[],A=0,l=SPA,H="Ok;Bad Json Request;Bad number of arguments;Bad arguments;Bad argument type;Bad request;Empty request;Not supported;Authentication failed".split(";");
(function(b,h,f,l){b.addEventListener?b.addEventListener(h,f,l):b.attachEvent&&(b["e"+h+f]=f,b[h+f]=function(){b["e"+h+f](t.event)},b.attachEvent("on"+h,b[h+f]))})(t,"unload",function(b){for(b=u.length-1;0<=b;--b){var h=u[b];h&&h.isOpen()&&h.close()}u=[]},!1);r.count=function(){return u.length};r.host=function(b){b&&"string"==typeof b&&(x=b);return x};r.version=function(){return 1.2};r.connect=function(b,h,f,r,p){function y(a){l.log("AJAX error = "+a);if(g&&"function"==typeof c.onError)c.onError(a)}
function t(){if(g)switch(g.readyState){case 0:case 1:B=0;break;case 2:case 3:B=1;v=new Date;break;case 4:a:if(v=new Date,300<=g.status||!B)y(g.statusText),g&&(600<=g.status||!B)&&(c.close(),z());else{var a,d,C,e=JSON.parse(g.responseText,K),b=[];g.abort();q.length&&(d=q[0],q.splice(0,1),F(g,t)&&(a=JSON.stringify(d),g.send(JSON.stringify(d)),l.log("Request <<"+a+">> dequeued and sent with call index = "+d.i)));e.rb?b=e.rb:b.push(e);C=b.length;for(a=0;a<C;++a){e=b[a];if(e.rc){y(H[e.rc]);z();break a}if(e.i){if(d=
I(e.i))e.n=d.m,"uswitchTo"==d.m&&(e.rc?(w="",y(H[e.rc])):(G=1,l.log("AJAX connected to "+x+p),w=e.id,D=e.pt,f&&f()),f=null),d.cb&&d.cb(e)}else if("function"==typeof c.push.onMessage)c.push.onMessage(e);l.log("Result <<"+JSON.stringify(e)+">> returned")}}break;default:throw"Unknown AJAX event";}}function F(a,d){a.onreadystatechange=d;try{a.open("POST",x+p,!sync)}catch(C){return l.log("Fatal exception caught during sending request and connection will be closed"),y(C.toString()),c.close(),z(),0}a.setRequestHeader("uhttprequest",
"1");a.setRequestHeader("Content-Type","application/json; charset=utf-8");return 1}function I(a){var d,c,e=m.length;for(c=0;c<e;++c)if(m[c].i==a){d=m[c];m.splice(c,1);break}return d}function z(){r&&(r(),r=null);g=null;l.log("AJAX closed");a:{var a=c,d,b=u.length;for(d=0;d<b;++d)if(u[d]===a){u.splice(d,1);break a}}G=0;k.b=0;q=[];m=[]}var G=0,g=J(),c={},n=0,m=[],q=[],B=1,E=l.debug()?805306367:3E4,v=new Date,w="",D=3E5;sync=0;var k={b:0,rb:[]};"string"!=typeof p&&(p="");p=p.replace(/^\s+|\s+$/g,"");
p.indexOf("/")||(p=p.substr(1));l.log("AJAX connecting to "+x+p+" ......");c.isBatching=function(){return!!k.b};c.getBatchSize=function(){return JSON.stringify(k).length-15};c.beginBatching=function(){if(!g)throw"AJAX connection closed!";k.b=1};c.commit=function(a){if(!g)throw"AJAX connection closed!";k.b=0;k.rb.length&&(c.sendRequest("udoBatch",!!a,k.rb),k.rb=[]);return n};c.rollback=function(){if(!g)throw"AJAX connection closed!";var a,d=k.rb.length;for(a=0;a<d;++a)I(k.rb[a].i);k.rb=[];k.b=0};c.msg=
function(){};c.timeout=function(a){"number"==typeof a&&1E3<=a&&(E=a);return E};c.pingTime=function(a){"number"==typeof a&&1E3<=a&&59E3>=a&&(D=a);return D};c.channel=function(){return p};c.close=function(){q=[];m=[];E=1E3;c.isOpen()&&(sync=0,c.sendRequest("uclose",function(a){z()}));w=""};c.isOpen=function(){return!!g&&!!G&&17<w.length};c.script=function(){return g};c.userId=function(){return b};c.cancel=function(){if(k.b)throw"Bad operation -- batching requests";var a={aborted:q.length,ignored:m.length-
q.length};m=[];q=[];return a};c.count=function(){return m.length+q.length};c.callIndex=function(){return n};c.sendRequest=function(){if(!c.isOpen())throw"AJAX connection closed!";if(!c.count()&&!F(g,t))return 0;n=++A;var a,d,b,e=Array.prototype.slice.call(arguments),f=e.length;if(1>f)throw"Valid request name required";b=e[0];if(!b||"string"!=typeof b)throw"Valid request name required";if(!/^([a-zA-Z_][\w]*)$/.exec(b))throw"Valid request name required";d={n:b,i:A,v:1.2,id:w};e.splice(0,1);--f;var h=
{m:b,i:A};f&&"function"==typeof e[f-1]&&(a=e[f-1],e.splice(f-1,1),h.cb=a);"udoBatch"!=b&&m.push(h);d.a=e;if(k.b&&"uping"!=b)return k.rb.push(d),l.log("Request "+b+" batched with call index = "+n),v=new Date,n;2>m.length-k.rb.length?(v=new Date,d=JSON.stringify(d),g.send(d),l.log("Request <<"+d+">> sent with call index = "+n)):(q.push(d),l.log("Request "+b+" queued with call index = "+n));return n};c.push=function(){function a(d){if("object"!=typeof d||!d.sort)throw"Invalid chat groups";for(var a=
0;a<d.length;++a){var c=parseInt(d[a]);c?d[a]=c:(d.splice(a,1),--a)}}return{ws:function(){return c},speak:function(d,b,e){a(b);return c.sendRequest("uspeak",d,b,e)},sendUserMessage:function(a,b,e){return c.sendRequest("usendUserMessage",b,a,e)},enter:function(d,f){a(d);return c.sendRequest("uenter",d,b,f)},exit:function(a){return c.sendRequest("uexit",a)}}}();u.push(c);if(!F(g,t))return 0;n=++A;m.push({m:"uswitchTo",i:n});g.send(JSON.stringify({n:"uswitchTo",i:n,v:1.2,id:w,a:[b,h]}));l.log("Request uswitchTo sent with call index = "+
n);setInterval(function(a){a=new Date;var b=a.getTime()-v.getTime();c.count()?b>E&&(y("Communication timed out"),c.close(),z()):c.isOpen()&&b>D&&(v=a,a=k.b,k.b=0,c.sendRequest("uping",function(a){}),k.b=a)},250);return c};return r}